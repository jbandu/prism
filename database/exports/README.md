# Database Schema Exports

This directory contains **actual database schema exports** from the production Neon database.

## Purpose

Since the Prism database schema has evolved through both:
1. Migration files (`database/migrations/*.sql`)
2. Direct SQL commands run in Neon SQL Editor

...these export files represent the **source of truth** for what's actually deployed.

## Files

- **`schema-latest.sql`** - Most recent complete schema (auto-updated)
- **`schema-latest.md`** - Human-readable documentation (auto-updated)
- **`schema-YYYY-MM-DD.sql`** - Dated snapshots for history
- **`schema-YYYY-MM-DD.md`** - Dated documentation

## Schema Contents

**Current Schema:**
- **47 tables** across multiple domains
- **52 foreign key relationships**
- **119 indexes** for performance
- **Multiple views** for reporting

### Table Breakdown by Domain:

**Core:**
- companies, users, company_users
- software, software_assets
- usage_analytics

**Enterprise Intelligence:**
- company_metrics, contacts, vendors
- contracts, initiatives, opportunities
- pain_points, intelligence_notes
- technologies

**Feature Analysis:**
- software_catalog, feature_categories
- software_features, software_features_mapping
- feature_overlaps, feature_comparison_matrix
- consolidation_recommendations
- feature_analysis_cache (AI extraction cache)

**Cost Optimization:**
- prism_savings_log
- alternative_solutions
- negotiation_playbooks, negotiation_outcomes
- renewal_negotiations, replacement_projects

**AI & Automation:**
- ai_agent_analyses
- workflow_automations
- brand_logos (for UI)

**Reporting Views:**
- v_admin_overview
- v_company_dashboard
- v_portfolio_overview
- v_cost_optimization
- v_upcoming_renewals
- v_high_risk_vendors
- v_replacement_candidates
- v_high_priority_pain_points

## How to Update

Run the export script to capture the latest schema:

```bash
cd prism-web
npm run schema:export
```

This will:
1. Connect to your Neon database
2. Query all tables, columns, constraints, and indexes
3. Generate both SQL and Markdown files
4. Update `schema-latest.*` files
5. Create dated snapshot files

## When to Export

Run the export script:
- ✅ After running migrations
- ✅ After manual schema changes in Neon SQL Editor
- ✅ Before major deployments
- ✅ Monthly for historical snapshots
- ✅ When documenting the system

## Comparison with Migrations

The migration files in `database/migrations/` represent **incremental changes**, while these exports represent the **complete current state**.

**Migrations** = How we got here
**Exports** = Where we are now

## Auto-Generated

These files are auto-generated by `prism-web/scripts/export-schema.ts`.
Do not manually edit. To modify the schema, either:
1. Create a new migration file
2. Run SQL in Neon Editor, then re-export

---

**Last Updated:** See git commit history
**Maintained By:** Schema export script (automated)
